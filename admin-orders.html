<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Customer Orders</title>
    
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/admin.css">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div class="admin-container" style="max-width: 600px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>üì¶ Customer Orders</h2>
            <button onclick="window.location.href='admin.html'" style="background: #333; width: auto; padding: 5px 10px;">Back</button>
        </div>
        
        <div id="ordersContainer">
            <p>Loading orders...</p>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script> <!-- ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® -->
    
    <script>
        // ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü
        async function loadOrders() {
            const container = document.getElementById('ordersContainer');

            // Supabase ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶æ (‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá)
            const { data: orders, error } = await supabase
                .from('orders')
                .select('*')
                .order('created_at', { ascending: false });

            container.innerHTML = ""; // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶∏‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶´‡ßá‡¶≤‡¶æ

            if (error) {
                container.innerHTML = `<p style="color:red">Error: ${error.message}</p>`;
                return;
            }

            if (orders.length === 0) {
                container.innerHTML = "<p>No orders found!</p>";
                return;
            }

            // ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã
            orders.forEach(order => {
                const date = new Date(order.created_at).toLocaleString();
                
                const div = document.createElement('div');
                div.className = 'order-card';
                div.innerHTML = `
                    <div class="order-header">
                        <span class="order-id">Order ID: #${order.id}</span>
                        <span class="order-date">${date}</span>
                    </div>
                    <div class="customer-info">
                        <strong>üë§ ${order.customer_name}</strong> <br>
                        üìû <a href="tel:${order.phone}">${order.phone}</a> <br>
                        üìç ${order.address}
                    </div>
                    <div class="order-items">
                        <strong>Items:</strong> <br>
                        ${order.items}
                    </div>
                    <div class="order-total">
                        Total Bill: ‚Çπ${order.total_amount}
                    </div>
                    <button onclick="deleteOrder(${order.id})" class="delete-btn">Mark as Delivered (Delete)</button>
                `;
                container.appendChild(div);
            });
        }

        // ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá ‡¶ó‡ßá‡¶≤‡ßá)
        async function deleteOrder(id) {
            if(confirm("Are you sure this order is delivered? It will be deleted.")) {
                const { error } = await supabase
                    .from('orders')
                    .delete()
                    .eq('id', id);
                
                if(!error) {
                    alert("Order removed!");
                    loadOrders(); // ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
                } else {
                    alert("Error deleting!");
                }
            }
        }

        // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá
        loadOrders();
    </script>

</body>
</html>